(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var e,t;e=class{constructor(){this.url="ws://127.0.0.1:7542",this.retryInterval=5e3,this.reconnectLoopId=-1,this.socket=null,Spicetify.Player.addEventListener("onplaypause",()=>this.sendPlayerData()),Spicetify.Player.addEventListener("songchange",()=>this.sendPlayerData()),Spicetify.Player.addEventListener("onprogress",()=>this.sendPlayerData()),setInterval(()=>{Spicetify.Player.isPlaying()||this.sendPlayerData()},1e3)}connect(){console.log("Attempting to connect to "+this.url),this.socket=new WebSocket(this.url),this.socket.onopen=()=>{var e;console.log("WebSocket connection established."),null!=(e=this.socket)&&e.send(JSON.stringify({target:"spotify",type:"target"})),this.sendPlayerData(),-1!==this.reconnectLoopId&&(clearInterval(this.reconnectLoopId),this.reconnectLoopId=-1)},this.socket.onmessage=e=>{this.handleCommand(e.data.toLowerCase())},this.socket.onclose=()=>{console.warn("WebSocket closed. Reconnecting..."),-1===this.reconnectLoopId&&(this.reconnectLoopId=setInterval(()=>this.connect(),this.retryInterval))},this.socket.onerror=()=>{var e;console.error("WebSocket error. Reconnecting..."),null!=(e=this.socket)&&e.close()}}handleCommand(e){switch(console.log("Got command: "+e),e){case"toggle_play":Spicetify.Player.togglePlay();break;case"previous":5e3<Spicetify.Player.getProgress()?Spicetify.Player.seek(0):Spicetify.Player.back();break;case"next":Spicetify.Player.next();break;case"toggle_shuffle":Spicetify.Player.toggleShuffle();break;case"toggle_repeat":Spicetify.Player.setRepeat(2===Spicetify.Player.getRepeat()?1:2);break;case"lower_volume":Spicetify.Player.setVolume(Math.max(0,Spicetify.Player.getVolume()-.05));break;case"increase_volume":Spicetify.Player.setVolume(Math.min(1,Spicetify.Player.getVolume()+.05))}this.sendPlayerData()}sendPlayerData(){var e;this.socket&&(null==(e=this.socket)?void 0:e.readyState)===WebSocket.OPEN&&null!=(e=this.socket)&&e.send(JSON.stringify({target:"spotify",type:"sync",data:{playing:Spicetify.Player.isPlaying(),shuffle:Spicetify.Player.getShuffle(),repeat:2===Spicetify.Player.getRepeat()}}))}},t=async function(){(new e).connect()},(async()=>{await t()})()})();